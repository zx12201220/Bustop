var Q=Object.defineProperty,tt=Object.defineProperties;var et=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var st=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable;var J=(t,e,i)=>e in t?Q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,C=(t,e)=>{for(var i in e||(e={}))st.call(e,i)&&J(t,i,e[i]);if(U)for(var i of U(e))ot.call(e,i)&&J(t,i,e[i]);return t},O=(t,e)=>tt(t,et(e));import{L as it,a as R,m as at,r as p,o as c,c as l,b as _,w as k,F as f,p as w,d as B,e as s,f as nt,s as rt,g as ct,h as lt,i as dt,j as ut,k as ht,l as _t,W as G,n as g,q as P,t as N,u as v,v as $,x as pt,y as S,z as x,A as y,B as A,J as vt,C as F,D as ft,E as mt,G as St,H as $t,I as gt}from"./vendor.838136ba.js";const yt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function i(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=i(o);fetch(o.href,a)}};yt();var m=(t,e)=>{const i=t.__vccOpts||t;for(const[n,o]of e)i[n]=o;return i};const Lt={name:"App",components:{Loading:it},computed:{isLoading(){return this.$store.state.isLoading}},created(){this.initialize(),window.addEventListener("resize",this.detectWindowWidth),this.$nextTick(()=>{navigator.geolocation&&(console.log("\u521D\u59CB\u5316\u5EA7\u6A19"),navigator.geolocation.getCurrentPosition(t=>{const e=t.coords;R.get(`https://api.nlsc.gov.tw/other/TownVillagePointQuery/${e.longitude}/${e.latitude}/4326/`).then(i=>{const n=i.data.ctyName;console.log(n),this.$store.commit("setLocation",n),this.$store.commit("setMapCenter",[e.latitude,e.longitude]),this.$store.commit("setGps",[e.latitude,e.longitude])}).catch(i=>console.log(i))}))}),this.$route.path=="/"&&this.$router.push("/searchBus")},destroyed(){window.removeEventListener("resize",this.detectWindowWidth)},mounted(){},methods:O(C({},at(["setWindowWidth"])),{initialize(){this.detectWindowWidth()},detectWindowWidth(){this.setWindowWidth(window.innerWidth)}})},bt=t=>(w("data-v-12915140"),t=t(),B(),t),wt=bt(()=>s("div",{class:"loadingio-spinner-ripple-ljxkgz2dr4f"},[s("div",{class:"ldio-b6pegcgibx6"},[s("div"),s("div")])],-1));function Bt(t,e,i,n,o,a){const r=p("loading"),d=p("router-view");return c(),l(f,null,[_(r,{active:a.isLoading,"onUpdate:active":e[0]||(e[0]=u=>a.isLoading=u),"can-cancel":!0,"is-full-page":!0},{default:k(()=>[wt]),_:1},8,["active"]),_(d)],64)}var kt=m(Lt,[["render",Bt],["__scopeId","data-v-12915140"]]);const V=nt({state:{isLoading:!1,windowWidth:0,gps:[],mapCenter:[23.97565,120.9738819],selectLocation:"Taichung",location:"",locationEn:"",searchBusRoute:{location:"",routeName:"",OperatorName:"",startStop:"",endStop:""},startStopOfRoute:[],endStopOfRoute:[],busPageActiveIndex:0,startLine:null,endLine:null,isMobileShow:!1,nearBusStop:[],nearBusStopActiveIndex:0,gpsOnce:!0},mutations:{setLoading(t,e){t.isLoading=e},setWindowWidth(t,e){t.windowWidth=e},setGps(t,e){t.gps=e},setMapCenter(t,e){t.mapCenter=e},setSelectLocation(t,e){t.selectLocation=e},setLocation(t,e){t.location=e},setLocationEn(t,e){t.locationEn=e},setSearchBusRoute(t,e){t.searchBusRoute=e},setStartStopOfRoute(t,e){t.startStopOfRoute=e},setEndStopOfRoute(t,e){t.endStopOfRoute=e},setBusPageActiveIndex(t,e){t.busPageActiveIndex=e},setStartLine(t,e){t.startLine=e},setEndLine(t,e){t.endLine=e},setisMobileShow(t,e){t.isMobileShow=e},setNearBusStop(t,e){t.nearBusStop=e},setNearBusStopActiveIndex(t,e){t.nearBusStopActiveIndex=e},setGpsOnce(t,e){t.gpsOnce=e}},getters:{windowWidth:t=>t.windowWidth}});const Nt={name:"main-header",methods:{goHome(){this.$router.push("/searchBus")}}},Ct={class:"header"},Ot=s("div",{class:"icon-bookmark2"},null,-1);function Rt(t,e,i,n,o,a){return c(),l("header",Ct,[s("div",{class:"logo",onClick:e[0]||(e[0]=(...r)=>a.goHome&&a.goHome(...r))}),Ot])}var z=m(Nt,[["render",Rt]]);const xt={name:"v-footer"},It={class:"footer"};function Mt(t,e,i,n,o,a){return c(),l("footer",It,"Bustop\xA9 - All Rights Reserved.")}var D=m(xt,[["render",Mt]]);const Tt={name:"v-map",components:{LMap:rt,LIcon:ct,LTileLayer:lt,LMarker:dt,LTooltip:ut,LPopup:ht,LGeoJson:_t},data(){return{data:[],zoom:11,center:this.$store.state.mapCenter,centerSize:[41,41],url:"https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{zoomControl:!1,zoomSnap:.5,attributionControl:!1},icon:{type:{black:"./marker_none.png",pitStop:"./marker_pitStop.png",comming:"./marker_comming.png",center:"./gpsCenter.png",blue:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png",black1:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-black.png"},iconSize:[20,20],iconAnchor:[9,32],popupAnchor:[1,-34]},busPageActiveIndex:this.$store.state.busPageActiveIndex,startStopOfRoute:[],endStopOfRoute:[],geojson:null,startLine:null,endLine:{coordinates:[],type:"LineString"},nearBusStop:[]}},methods:{zoomUpdate(t){this.zoom=t},centerUpdate(t){this.center=t}},watch:{"$store.state.isMobileShow":{handler:function(t,e){t==!0&&this.$refs.myMap.leafletObject._onResize()}},"$store.state.busPageActiveIndex":{handler:function(t,e){this.busPageActiveIndex=t,t==0?(this.data=this.startStopOfRoute,this.geojson=this.startLine):t==1&&(this.data=this.endStopOfRoute,this.geojson=this.endLine)},immediate:!0},"$store.state.startStopOfRoute":{handler:function(t,e){(t!==[]||t===void 0)&&(this.startStopOfRoute=[],t.forEach((i,n)=>{this.startStopOfRoute.push({id:n,name:i.StopName.Zh_tw,state:i.state,local:[i.StopPosition.PositionLat,i.StopPosition.PositionLon]})}),this.$store.state.busPageActiveIndex==0&&(this.data=this.startStopOfRoute))}},"$store.state.endStopOfRoute":{handler:function(t,e){(t!==[]||t===void 0)&&(this.endStopOfRoute=[],t.forEach((i,n)=>{this.endStopOfRoute.push({id:n,name:i.StopName.Zh_tw,state:i.state,local:[i.StopPosition.PositionLat,i.StopPosition.PositionLon]})}),this.$store.state.busPageActiveIndex==1&&(this.data=this.endStopOfRoute))}},"$store.state.startLine":{handler:function(t,e){if(t!==null){const n=new G.Wkt().read(t).toJson();this.startLine=n,this.busPageActiveIndex==0&&(this.geojson=n)}else t===null&&(this.geojson={coordinates:[],type:"LineString"})},immediate:!0},"$store.state.endLine":{handler:function(t,e){if(t!==null){const n=new G.Wkt().read(t).toJson();this.endLine=n,this.busPageActiveIndex==1?this.geojson=n:t===null&&(this.geojson={coordinates:[],type:"LineString"})}},immediate:!0},"$store.state.nearBusStop":{handler:function(t,e){this.nearBusStop=[],t.forEach(i=>{this.nearBusStop.push(O(C({},i),{local:[i.StationPosition.PositionLat,i.StationPosition.PositionLon]}))})}},data:{handler:function(t,e){(t!==[]||t===void 0)&&this.$nextTick(()=>{const i=t[parseInt(t.length/2)];i!==void 0&&(this.centerSize=[0,0],this.centerUpdate(i.local),this.zoomUpdate(15))})}},zoom(t,e){t>=17&&this.zoomUpdate(e)},isGpsReady:{handler:function(t,e){this.$nextTick(()=>{t&&this.$route.fullPath!=="/busResult"&&(this.$route.fullPath!=="/searchBus"?this.centerUpdate(this.$store.state.gps):setTimeout(()=>{this.centerUpdate(this.$store.state.gps),this.centerSize=[41,41],setTimeout(()=>{this.zoomUpdate(16)},1e3)},1e3))})},immediate:!0}},computed:{isGpsReady(){const t=this.$store.state.gps;return!(t==""||t==[])}},mounted(){this.$store.state.nearBusStop[0]!==void 0&&(this.nearBusStop=[],this.$store.state.nearBusStop.forEach(t=>{this.nearBusStop.push(O(C({},t),{local:[t.StationPosition.PositionLat,t.StationPosition.PositionLon]}))}))}},Ht={class:"v-map"},Pt=N(" \u4F60\u7684\u4F4D\u7F6E ");function At(t,e,i,n,o,a){const r=p("l-tile-layer"),d=p("l-icon"),u=p("l-popup"),h=p("l-marker"),b=p("l-geo-json"),I=p("l-map");return c(),l("div",Ht,[_(I,{ref:"myMap",zoom:o.zoom,maxZoom:16,center:o.center,options:o.options,"onUpdate:zoom":a.zoomUpdate,style:{height:"100%"}},{default:k(()=>[_(r,{url:o.url},null,8,["url"]),_(h,{ref:"location","lat-lng":o.center},{default:k(()=>[_(d,{"icon-url":o.icon.type.center,"icon-size":o.centerSize},null,8,["icon-url","icon-size"]),_(u,null,{default:k(()=>[Pt]),_:1})]),_:1},8,["lat-lng"]),(c(!0),l(f,null,g(o.data,L=>(c(),P(h,{"lat-lng":L.local,key:L.id},{default:k(()=>[_(d,{"icon-url":L.state==="comming"?o.icon.type.comming:L.state==="pitStop"?o.icon.type.pitStop:o.icon.type.black,"icon-size":o.icon.iconSize,"popup-anchor":o.icon.popupAnchor},null,8,["icon-url","icon-size","popup-anchor"]),_(u,null,{default:k(()=>[N(v(L.name),1)]),_:2},1024)]),_:2},1032,["lat-lng"]))),128)),(c(!0),l(f,null,g(o.nearBusStop,(L,E)=>(c(),P(h,{"lat-lng":L.local,key:E},{default:k(()=>[_(d,{"icon-url":t.$store.state.nearBusStopActiveIndex===E?o.icon.type.blue:o.icon.type.black1,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41],"popup-anchor":o.icon.popupAnchor},null,8,["icon-url","popup-anchor"]),_(u,null,{default:k(()=>[N(v(L.StationName.Zh_tw),1)]),_:2},1024)]),_:2},1032,["lat-lng"]))),128)),_(b,{geojson:o.geojson,stroke:"#000",optionsStyle:{stroke:"#000",weight:4,opacity:1}},null,8,["geojson"])]),_:1},8,["zoom","center","options","onUpdate:zoom"])])}var M=m(Tt,[["render",At],["__scopeId","data-v-33925900"]]);const Wt={name:"select-location",data(){return{selectLocation:"Taichung",locationList:[{CityName:"\u81FA\u5317\u5E02",City:"Taipei"},{CityName:"\u65B0\u5317\u5E02",City:"NewTaipei"},{CityName:"\u6843\u5712\u5E02",City:"Taoyuan"},{CityName:"\u81FA\u4E2D\u5E02",City:"Taichung"},{CityName:"\u81FA\u5357\u5E02",City:"Tainan"},{CityName:"\u9AD8\u96C4\u5E02",City:"Kaohsiung"},{CityName:"\u57FA\u9686\u5E02",City:"Keelung"},{CityName:"\u65B0\u7AF9\u5E02",City:"Hsinchu"},{CityName:"\u65B0\u7AF9\u7E23",City:"HsinchuCounty"},{CityName:"\u82D7\u6817\u7E23",City:"MiaoliCounty"},{CityName:"\u5F70\u5316\u7E23",City:"ChanghuaCounty"},{CityName:"\u5357\u6295\u7E23",City:"NantouCounty"},{CityName:"\u96F2\u6797\u7E23",City:"YunlinCounty"},{CityName:"\u5609\u7FA9\u7E23",City:"ChiayiCounty"},{CityName:"\u5609\u7FA9\u5E02",City:"Chiayi"},{CityName:"\u5C4F\u6771\u7E23",City:"PingtungCounty"},{CityName:"\u5B9C\u862D\u7E23",City:"YilanCounty"},{CityName:"\u82B1\u84EE\u7E23",City:"HualienCounty"},{CityName:"\u81FA\u6771\u7E23",City:"TaitungCounty"},{CityName:"\u91D1\u9580\u7E23",City:"KinmenCounty"},{CityName:"\u6F8E\u6E56\u7E23",City:"PenghuCounty"},{CityName:"\u9023\u6C5F\u7E23",City:"LienchiangCounty"}]}},watch:{selectLocation:{handler(t,e){this.$store.commit("setSelectLocation",t)}},location:{handler:function(t,e){if(t!==""){for(let i=0;i<this.locationList.length;i++)if(this.locationList[i].CityName==this.location){this.selectLocation=this.locationList[i].City,this.$store.commit("setLocationEn",this.locationList[i].City);break}}}}},computed:{location(){return this.$store.state.location}},mounted(){const t=this.$store.state.selectLocation;this.selectLocation=t}},Et=t=>(w("data-v-52db777e"),t=t(),B(),t),Ft={class:"select-row"},zt=Et(()=>s("h2",null,"\u6211\u5728",-1)),Dt=["value"];function jt(t,e,i,n,o,a){return c(),l("div",Ft,[zt,$(s("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.selectLocation=r)},[(c(!0),l(f,null,g(o.locationList,(r,d)=>(c(),l("option",{value:r.City,key:d},v(r.CityName),9,Dt))),128))],512),[[pt,o.selectLocation]])])}var j=m(Wt,[["render",jt],["__scopeId","data-v-52db777e"]]);const Zt={name:"sidebarWrap",components:{Header:z,Footer:D,Map:M,SelectLocation:j},data(){return{buttonList:[{title:"\u516C\u8ECA\u52D5\u614B",icon:"icon-bus",icon2:"icon-bus2",url:"/searchBus"},{title:"\u898F\u5283\u8DEF\u7DDA",icon:"icon-route",icon2:"icon-route2",url:"/searchPlan"}],activeIndex:0}},methods:{activeHandler(t,e){this.activeIndex=t,this.$router.push(e)}},watch:{$route(t,e){t.path==="/searchBus"?this.activeIndex=0:t.path==="/searchPlan"&&(this.activeIndex=1)}},computed:{isLoading(){return this.$store.state.isLoading}},mounted(){const t=this.$route.path;t==="/searchBus"?this.activeIndex=0:t==="/searchPlan"&&(this.activeIndex=1),this.isLoading&&setTimeout(()=>{this.$store.commit("setLoading",!1)},3e3)}},Kt={class:"main"},Ut={class:"sidebarWrap"},Jt={class:"buttons-row"},Gt=["onClick"],Vt={class:"map"};function Xt(t,e,i,n,o,a){const r=p("Header"),d=p("SelectLocation"),u=p("router-view"),h=p("Map"),b=p("Footer");return c(),l(f,null,[_(r),s("div",Kt,[s("div",Ut,[_(d),s("div",Jt,[(c(!0),l(f,null,g(o.buttonList,(I,L)=>(c(),l("div",{class:S(["button",{active:L==o.activeIndex}]),key:L,onClick:E=>a.activeHandler(L,I.url)},[L!==o.activeIndex?(c(),l("div",{key:0,class:S(I.icon)},null,2)):L===o.activeIndex?(c(),l("div",{key:1,class:S(I.icon2)},null,2)):x("",!0),N(" "+v(I.title),1)],10,Gt))),128))]),_(u)]),s("div",Vt,[_(h)])]),_(b)],64)}var qt=m(Zt,[["render",Xt],["__scopeId","data-v-bee871d4"]]);const Yt={name:"favorite-list",data(){return{favoriteList:[{icon:"icon-company",title:"\u516C\u53F8",location:"\u53F0\u7063\u5927\u9053\u4E8C\u6BB5200\u865F"},{icon:"icon-searhHistory",title:"\u516C\u53F8",location:"\u53F0\u7063\u5927\u9053\u4E8C\u6BB5200\u865F"}]}}},Qt={class:"favorite-location-list"},te={class:"info"},ee={class:"title"},se={class:"location"},oe=s("div",{class:"icon-bookmark2"},null,-1),ie=s("div",{class:"more-btn"},[N(" \u5C55\u958B\u66F4\u591A "),s("div",{class:"icon-back"})],-1);function ae(t,e,i,n,o,a){return c(),l("div",Qt,[s("ul",null,[(c(!0),l(f,null,g(o.favoriteList,(r,d)=>(c(),l("li",{key:d},[s("div",{class:S(r.icon)},null,2),s("div",te,[s("div",ee,v(r.title),1),s("div",se,v(r.location),1)]),oe]))),128))]),ie])}var X=m(Yt,[["render",ae]]);const ne={name:"history-list"},re={class:"history-list"},ce=s("div",{class:"history-title"},"\u641C\u5C0B\u904E\u7684\u5730\u9EDE",-1),le=s("ul",null,[s("li",null,[s("div",{class:"icon-bookmark2"}),s("h3",null,"\u516C\u53F8")]),s("li",null,[s("h3",null,"\u53F0\u4E2D\u6B4C\u5287\u9662")]),s("li",null,[s("h3",null,"\u53F0\u4E2D\u6B4C\u5287\u9662")]),s("li",null,[s("h3",null,"\u53F0\u4E2D\u6B4C\u5287\u9662")]),s("li",null,[s("h3",null,"\u53F0\u4E2D\u6B4C\u5287\u9662")])],-1),de=[ce,le];function ue(t,e,i,n,o,a){return c(),l("div",re,de)}var he=m(ne,[["render",ue]]);const _e={name:"search-plan",components:{FavoriteList:X,HistoryList:he},methods:{nextPage(){this.$router.push("/routePlan")}},computed:{isMobile(){return this.$store.state.windowWidth<=769}}},pe=t=>(w("data-v-087957ab"),t=t(),B(),t),ve={class:"search-row"},fe=pe(()=>s("div",{class:"warn"},[s("div",{class:"icon-notice"}),N(" \u76EE\u524D\u6B64\u9801\u9762\u529F\u80FD\u5C1A\u672A\u958B\u767C\u5B8C\u6210 ")],-1));function me(t,e,i,n,o,a){const r=p("HistoryList"),d=p("FavoriteList");return c(),l(f,null,[s("div",ve,[s("input",{type:"search",placeholder:"\u6211\u60F3\u53BB\u54EA\u88E1...?",onClick:e[0]||(e[0]=(...u)=>a.nextPage&&a.nextPage(...u))})]),fe,a.isMobile?(c(),P(r,{key:0})):a.isMobile?x("",!0):(c(),P(d,{key:1}))],64)}var Se=m(_e,[["render",me],["__scopeId","data-v-087957ab"]]);const $e={name:"favorite-bus-list",data(){return{favoriteList:[],hasData:!1,isShowMore:!1,isOver:!1}},methods:{isFirstUse(){return localStorage.getItem("busTop_isFirst")===null?(localStorage.setItem("busTop_isFirst",!0),localStorage.setItem("busTop_favorlist",JSON.stringify([{location:"Taoyuan",routeName:"151",OperatorName:"\u6843\u5712\u5BA2\u904B",startStop:"\u540C\u5B89\u8857",endStop:"\u6843\u5712"},{location:"Taipei",routeName:"\u7D0525",OperatorName:"\u9996\u90FD\u5BA2\u904B",startStop:"\u6377\u904B\u5317\u9580\u7AD9",endStop:"\u5357\u6E2F"}])),!0):!1},getFavoriteList(){let t=localStorage.getItem("busTop_favorlist");return t!==null?JSON.parse(t):[]},saveFavoriteList(t){localStorage.setItem("busTop_favorlist",JSON.stringify(t))},likeHandler(t){let e=this.getFavoriteList(),i=this.favoriteList[t].favorite;if(!i)e.push({location:this.$store.state.selectLocation,routeName:this.favoriteList[t].title,OperatorName:this.favoriteList[t].OperatorName,startStop:this.favoriteList[t].startStop,endStop:this.favoriteList[t].endStop}),this.saveFavoriteList(e),this.favoriteList[t].favorite=!0;else if(i){let n=e.filter(o=>o.locationthis!==this.$store.state.selectLocation&&o.routeName!==this.favoriteList[t].title);this.saveFavoriteList(n),this.favoriteList[t].favorite=!1}},nextPage(t,e,i,n,o){this.$store.commit("setSearchBusRoute",{location:o,routeName:t,OperatorName:e,startStop:i,endStop:n}),this.$router.push("/busResult")}},computed:{isMobile(){return this.$store.state.windowWidth<=769}},mounted(){this.isFirstUse();let t=this.getFavoriteList();this.favoriteList=[],t.forEach(e=>{this.favoriteList.push({icon:"icon-bus",title:e.routeName,location:e.location,BusStopToFrom:e.BusStopToFrom,OperatorName:e.OperatorName,startStop:e.startStop,endStop:e.endStop,favorite:!0})}),this.favoriteList.length>2&&(this.isShowMore=!0,this.isOver=!0),this.favoriteList.length!==0&&(this.hasData=!0)}},q=t=>(w("data-v-6b428ad8"),t=t(),B(),t),ge={class:"favoriteBusList"},ye={key:0,class:"title-row"},Le=q(()=>s("div",{class:"icon-heart1"},null,-1)),be=q(()=>s("h2",null,"\u6211\u7684\u6700\u611B",-1)),we=[Le,be],Be={key:1},ke=["onClick"],Ne={class:"info"},Ce={class:"title"},Oe={class:"location"},Re=["onClick"],xe=["onClick"],Ie={class:"info"},Me={class:"title"},Te={class:"location"},He=["onClick"],Pe=["onClick"],Ae={class:"info"},We={class:"title"},Ee={class:"location"},Fe=["onClick"],ze={class:"icon-back"},De={class:"icon-back icon-up"};function je(t,e,i,n,o,a){return c(),l("div",ge,[a.isMobile?$((c(),l("div",ye,we,512)),[[y,o.hasData]]):x("",!0),o.isOver?o.isOver?(c(),l(f,{key:2},[s("ul",null,[(c(!0),l(f,null,g(o.favoriteList.slice(0,2),(r,d)=>$((c(),l("li",{key:d,class:S({borderBottomNone:d==1}),onClick:u=>a.nextPage(r.title,r.OperatorName,r.startStop,r.endStop,r.location)},[s("div",{class:S(r.icon)},null,2),s("div",Ie,[s("div",Me,v(r.title),1),s("div",Te,v(r.startStop)+" - "+v(r.endStop),1)]),s("div",{onClick:A(u=>a.likeHandler(d),["stop"]),class:S({"icon-heart1":r.favorite,"icon-heart2":!r.favorite})},null,10,He)],10,xe)),[[y,o.isShowMore]])),128)),(c(!0),l(f,null,g(o.favoriteList,(r,d)=>$((c(),l("li",{key:d,onClick:u=>a.nextPage(r.title,r.OperatorName,r.startStop,r.endStop,r.location)},[s("div",{class:S(r.icon)},null,2),s("div",Ae,[s("div",We,v(r.title),1),s("div",Ee,v(r.startStop)+" - "+v(r.endStop),1)]),s("div",{onClick:A(u=>a.likeHandler(d),["stop"]),class:S({"icon-heart1":r.favorite,"icon-heart2":!r.favorite})},null,10,Fe)],8,Pe)),[[y,!o.isShowMore]])),128))]),s("div",{class:"more-btn",onClick:e[0]||(e[0]=r=>o.isShowMore=!o.isShowMore)},[$(s("span",null,"\u5C55\u958B\u66F4\u591A",512),[[y,o.isShowMore]]),$(s("span",null,"\u6536\u8D77\u96B1\u85CF",512),[[y,!o.isShowMore]]),$(s("div",ze,null,512),[[y,o.isShowMore]]),$(s("div",De,null,512),[[y,!o.isShowMore]])])],64)):x("",!0):(c(),l("ul",Be,[(c(!0),l(f,null,g(o.favoriteList,(r,d)=>(c(),l("li",{key:d,onClick:u=>a.nextPage(r.title,r.OperatorName,r.startStop,r.endStop,r.location)},[s("div",{class:S(r.icon)},null,2),s("div",Ne,[s("div",Ce,v(r.title),1),s("div",Oe,v(r.startStop)+" - "+v(r.endStop),1)]),s("div",{onClick:A(u=>a.likeHandler(d),["stop"]),class:S({"icon-heart1":r.favorite,"icon-heart2":!r.favorite})},null,10,Re)],8,ke))),128))]))])}var Ze=m($e,[["render",je],["__scopeId","data-v-6b428ad8"]]);function T(){const t="3d6cd7f1884643bcb149703cf9cc138d",e="Z3rwrDVIwkFSkAnUrLDLfPw2cvA",i=new Date().toGMTString(),n=new vt("SHA-1","TEXT");n.setHMACKey(e,"TEXT"),n.update(`x-date: ${i}`);const o=n.getHMAC("B64");return{Authorization:`hmac username="${t}", algorithm="hmac-sha1", headers="x-date", signature="${o}"`,"X-Date":i}}const Ke={name:"ear-bus-stop",data(){return{activeIndex:0,nearByList:[],isShowMore:!1,isLoading:!0,gps:[]}},methods:{activeIndexHandler(t){this.activeIndex=t,this.$store.commit("setNearBusStopActiveIndex",t)},getNearByApi(t){this.isLoading=!0,R.get(`https://ptx.transportdata.tw/MOTC/v2/Bus/Station/NearBy?%24top=30&%24spatialFilter=nearby(${t[0]}%2C%20${t[1]}%2C%20300)&%24format=JSON`,{headers:T()}).then(e=>{this.nearByList=[],e.data.length>4&&(this.isShowMore=!0),e.data.forEach(i=>{this.nearByList.push(O(C({},i),{distance:this.calcDistance(this.$store.state.gps[0],this.$store.state.gps[1],i.StationPosition.PositionLat,i.StationPosition.PositionLon,"K")}))}),this.$store.commit("setNearBusStop",this.nearByList)}).then(()=>{this.isLoading=!1}).catch(e=>{console.log(e)})},calcDistance(t,e,i,n,o){if(t==i&&e==n)return 0;{let a=Math.PI*t/180,r=Math.PI*i/180,d=e-n,u=Math.PI*d/180,h=Math.sin(a)*Math.sin(r)+Math.cos(a)*Math.cos(r)*Math.cos(u);return h>1&&(h=1),h=Math.acos(h),h=h*180/Math.PI,h=h*60*1.1515,o=="K"&&(h=h*1.609344),o=="N"&&(h=h*.8684),parseInt(h*1e3)}}},mounted(){this.gps=this.$store.state.gps,this.gps[0]!==void 0&&this.getNearByApi(this.gps)},unmounted(){this.$store.commit("setNearBusStop",[]),this.$store.commit("setNearBusStopActiveIndex",0)},computed:{isMobile(){return this.$store.state.windowWidth<=769}},watch:{"$store.state.gps":{handler(t,e){this.getNearByApi(t)}}}},Ue={class:"near-bus-stop"},Je={key:0},Ge=s("li",{class:"loading"},null,-1),Ve=s("li",{class:"loading"},null,-1),Xe=s("li",{class:"loading"},null,-1),qe=s("li",{class:"loading"},null,-1),Ye=[Ge,Ve,Xe,qe],Qe={key:0},ts=["onClick"],es=["onClick"],ss=["onClick"],os={class:"icon-back"},is={class:"icon-back icon-up"};function as(t,e,i,n,o,a){return c(),l("div",Ue,[o.isLoading?(c(),l("ul",Je,Ye)):(c(),l(f,{key:1},[a.isMobile?(c(),l("ul",Qe,[(c(!0),l(f,null,g(o.nearByList,(r,d)=>(c(),l("li",{key:d,class:S({active:o.activeIndex==d}),onClick:u=>a.activeIndexHandler(d)},v(r.StationName.Zh_tw)+"("+v(r.distance)+"\u516C\u5C3A) ",11,ts))),128))])):a.isMobile?x("",!0):(c(),l(f,{key:1},[s("ul",null,[(c(!0),l(f,null,g(o.nearByList.slice(0,4),(r,d)=>$((c(),l("li",{key:d,class:S({active:o.activeIndex==d}),onClick:u=>a.activeIndexHandler(d)},v(r.StationName.Zh_tw)+"("+v(r.distance)+"\u516C\u5C3A) ",11,es)),[[y,o.isShowMore]])),128)),(c(!0),l(f,null,g(o.nearByList,(r,d)=>$((c(),l("li",{key:d,class:S({active:o.activeIndex==d}),onClick:u=>a.activeIndexHandler(d)},v(r.StationName.Zh_tw)+"("+v(r.distance)+"\u516C\u5C3A) ",11,ss)),[[y,!o.isShowMore]])),128))]),s("div",{class:"more-btn",onClick:e[0]||(e[0]=r=>o.isShowMore=!o.isShowMore)},[$(s("span",null,"\u5C55\u958B\u66F4\u591A",512),[[y,o.isShowMore]]),$(s("span",null,"\u6536\u8D77\u96B1\u85CF",512),[[y,!o.isShowMore]]),$(s("div",os,null,512),[[y,o.isShowMore]]),$(s("div",is,null,512),[[y,!o.isShowMore]])])],64))],64))])}var ns=m(Ke,[["render",as]]);const rs={name:"near-bus",data(){return{nearBusList:[],isLoading:!0}},methods:{getEstimatedTimeOfArrivalApi(t){this.isLoading=!0,R.get(`https://ptx.transportdata.tw/MOTC/v2/Bus/EstimatedTimeOfArrival/City/${this.$store.state.locationEn}/PassThrough/Station/${t}?%24top=30&%24format=JSON`,{headers:T()}).then(e=>{this.nearBusList=[],e.data.forEach(i=>{i.EstimateTime?this.nearBusList.push(O(C({},i),{status:i.EstimateTime/60+"\u5206\u9418"})):this.nearBusList.push(O(C({},i),{status:"\u672A\u767C\u8ECA"}))})}).then(()=>{this.isLoading=!1}).catch(e=>{console.log(e)})}},computed:{nearBusStop(){return this.$store.state.nearBusStop},nearBusStopActiveIndex(){return this.$store.state.nearBusStopActiveIndex}},watch:{nearBusStop(t){t!=""&&this.getEstimatedTimeOfArrivalApi(this.nearBusStop[this.nearBusStopActiveIndex].StationID)},nearBusStopActiveIndex(t){this.getEstimatedTimeOfArrivalApi(this.nearBusStop[this.nearBusStopActiveIndex].StationID)}}},cs={class:"near-bus"},ls=s("li",{class:"loading"},null,-1),ds=s("li",{class:"loading"},null,-1),us=s("li",{class:"loading"},null,-1),hs=s("li",{class:"loading"},null,-1),_s={class:"bus-number"},ps={class:"bus-time"},vs={class:"bus-destination"};function fs(t,e,i,n,o,a){return c(),l("div",cs,[s("ul",null,[o.isLoading?(c(),l(f,{key:0},[ls,ds,us,hs],64)):(c(!0),l(f,{key:1},g(o.nearBusList,(r,d)=>(c(),l("li",{key:d},[s("h1",_s,v(r.RouteName.Zh_tw),1),s("h4",ps,v(r.status),1),s("div",vs,v(r.StopName.Zh_tw),1)]))),128))])])}var ms=m(rs,[["render",fs]]);const Ss={name:"search-bus",components:{FavoriteBusList:Ze,NearBusStop:ns,NearBus:ms,Map:M},methods:{nextPage(){this.$router.push("/busTime")}},computed:{isMobile(){return this.$store.state.windowWidth<=769}}},Y=t=>(w("data-v-cceb5c24"),t=t(),B(),t),$s=Y(()=>s("div",{class:"icon-search"},null,-1)),gs=N(" \u641C\u5C0B\u516C\u8ECA\u8DEF\u7DDA/\u7AD9\u724C "),ys=[$s,gs],Ls=Y(()=>s("div",{class:"title-row"},[s("div",{class:"icon-station"}),s("h2",null,"\u9644\u8FD1\u7AD9\u724C")],-1)),bs={class:"m-map"};function ws(t,e,i,n,o,a){const r=p("FavoriteBusList"),d=p("Map"),u=p("NearBusStop"),h=p("NearBus");return c(),l(f,null,[s("div",{class:"search",onClick:e[0]||(e[0]=(...b)=>a.nextPage&&a.nextPage(...b))},ys),_(r),a.isMobile?(c(),l(f,{key:0},[Ls,s("div",bs,[_(d)])],64)):x("",!0),_(u),_(h)],64)}var Bs=m(Ss,[["render",ws],["__scopeId","data-v-cceb5c24"]]);const ks={name:"route-plan-main",components:{Header:z,Footer:D,Map:M},data(){return{isHeaderShow:!0}},watch:{"$store.state.windowWidth":{handler:function(t,e){t<=769?this.isHeaderShow=!1:this.isHeaderShow=!0},immediate:!0}}},Ns={class:"headerWrap"},Cs={class:"main"},Os={class:"sidebarWrap"},Rs={class:"map"};function xs(t,e,i,n,o,a){const r=p("Header"),d=p("router-view"),u=p("Map"),h=p("Footer");return c(),l(f,null,[$(s("div",Ns,[_(r)],512),[[y,o.isHeaderShow]]),s("div",Cs,[s("div",Os,[_(d)]),s("div",Rs,[_(u)])]),_(h)],64)}var Is=m(ks,[["render",xs],["__scopeId","data-v-3d58e04b"]]);const Ms={name:"route-header",methods:{goBackPage(){this.$router.go(-1)}}},Ts={class:"header"},Hs=s("div",{class:"title"},"\u8DEF\u7DDA\u898F\u5283",-1);function Ps(t,e,i,n,o,a){return c(),l("header",Ts,[s("div",{class:"icon-back",onClick:e[0]||(e[0]=(...r)=>a.goBackPage&&a.goBackPage(...r))}),Hs])}var H=m(Ms,[["render",Ps]]);const As={name:"history-more-list",data(){return{favoriteList:[{icon:"icon-searhHistory",title:"\u53F0\u4E2D\u570B\u5BB6\u6B4C\u5287\u9662",location:"\u53F0\u4E2D\u5E02\u897F\u5C6F\u5340\u60E0\u4F86\u8DEF\u4E8C\u6BB5101\u865F"},{icon:"icon-searhHistory",title:"\u5BE9\u8A08\u65B0\u6751",location:"\u53F0\u4E2D\u5E02\u897F\u5340\u6C11\u751F\u8DEF368\u5DF74\u5F048\u865F"},{icon:"icon-searhHistory",title:"\u52E4\u7F8E\u8AA0\u54C1\u7DA0\u5712\u9053",location:"\u53F0\u4E2D\u5E02\u897F\u5340\u516C\u76CA\u8DEF68\u865F"},{icon:"icon-searhHistory",title:"\u79CB\u7D05\u8C37",location:"\u53F0\u4E2D\u5E02\u897F\u5C6F\u5340\u671D\u5BCC\u8DEF30\u865F"},{icon:"icon-searhHistory",title:"\u540E\u8C50\u9435\u99AC\u9053",location:"\u53F0\u4E2D\u5E02\u8C50\u539F\u5340\u570B\u8C50\u8DEF\u4E09\u6BB5"}]}}},Ws=t=>(w("data-v-711da5c3"),t=t(),B(),t),Es={class:"historyMoreList"},Fs={class:"info"},zs={class:"title"},Ds={class:"location"},js=Ws(()=>s("div",{class:"icon-bookmark1"},null,-1));function Zs(t,e,i,n,o,a){return c(),l("div",Es,[s("ul",null,[(c(!0),l(f,null,g(o.favoriteList,(r,d)=>(c(),l("li",{key:d},[s("div",{class:S(r.icon)},null,2),s("div",Fs,[s("div",zs,v(r.title),1),s("div",Ds,v(r.location),1)]),js]))),128))])])}var Ks=m(As,[["render",Zs],["__scopeId","data-v-711da5c3"]]);const Us={name:"route-plan",components:{RouteHeader:H,FavoriteList:X,HistoryMoreList:Ks},mounted(){this.$refs.myinput.focus()}},W=t=>(w("data-v-6ac58ab5"),t=t(),B(),t),Js={class:"sidebarWrap"},Gs={class:"search-wrap"},Vs=W(()=>s("div",{class:"icons"},[s("span",{class:"circle"}),s("span",{class:"line"}),s("div",{class:"icon-location"})],-1)),Xs={class:"searchs"},qs=W(()=>s("h4",{class:"now-location"},"\u73FE\u5728\u4F4D\u7F6E",-1)),Ys={class:"search-location"},Qs={type:"search",placeholder:"\u6211\u60F3\u53BB\u54EA\u88E1...?",ref:"myinput"},to=W(()=>s("div",{class:"icon-search"},null,-1)),eo=W(()=>s("div",{class:"warn"},[s("div",{class:"icon-notice"}),N(" \u76EE\u524D\u6B64\u9801\u9762\u529F\u80FD\u5C1A\u672A\u958B\u767C\u5B8C\u6210 ")],-1));function so(t,e,i,n,o,a){const r=p("RouteHeader"),d=p("FavoriteList"),u=p("HistoryMoreList");return c(),l("div",Js,[_(r),s("div",Gs,[Vs,s("div",Xs,[qs,s("div",Ys,[s("input",Qs,null,512),to])])]),eo,_(d),_(u)])}var oo=m(Us,[["render",so],["__scopeId","data-v-6ac58ab5"]]);const io={name:"search-station-list"},ao={class:"searchStationList"},no=F('<h3>\u5EFA\u8B70\u8DEF\u7DDA</h3><p>\u627E\u52303\u500B\u7D50\u679C</p><div class="stationDetailsCard"><div class="head"><h3>\u6B65\u884C2\u5206\u9418</h3><div class="icon-back"></div><div class="icon-bus"></div><div class="number">55</div><div class="min">15\u5206\u9418</div></div><div class="body"><div class="body-row"><div class="icon-clock"></div><h4>\u4E0B\u53486:03-\u4E0B\u53486:18</h4></div><div class="body-row"><p>\u6BCF10\u5206\u9418\u4E00\u73ED\u5F9E\u53F0\u4E2D\u706B\u8ECA\u7AD9\u767C\u8ECA</p><span class="state crowded">\u4E0D\u64C1\u64E0</span><div class="icon-searhHistory"></div></div></div></div>',3),ro=[no];function co(t,e,i,n,o,a){return c(),l("div",ao,ro)}var lo=m(io,[["render",co]]);const uo={name:"bus-staion",components:{SearchStationList:lo,RouteHeader:H}},ho={class:"sidebarWrap"},_o=F('<div class="searchWrap" data-v-572942e0><h3 class="title" data-v-572942e0>\u524D\u5F80</h3><div class="search-row" data-v-572942e0><div class="icon-arrow" data-v-572942e0></div><input type="search" value="\u4E2D\u53CB\u767E\u8CA8" data-v-572942e0><div class="icon-bookmark1" data-v-572942e0></div></div></div>',1);function po(t,e,i,n,o,a){const r=p("RouteHeader"),d=p("SearchStationList");return c(),l("div",ho,[_(r),_o,_(d)])}var vo=m(uo,[["render",po],["__scopeId","data-v-572942e0"]]);const fo={name:"route-plan-result",components:{RouteHeader:H,Map:M},data(){return{isOpen:!1}}},mo=t=>(w("data-v-5349f0a1"),t=t(),B(),t),So={class:"sidebarWrap"},$o=mo(()=>s("div",{class:"back"},[s("div",{class:"icon-back"})],-1)),go={class:"m-top"},yo=F('<div class="head" data-v-5349f0a1><h3 data-v-5349f0a1>\u6B65\u884C2\u5206\u9418</h3><div class="icon-back" data-v-5349f0a1></div><div class="icon-bus" data-v-5349f0a1></div><div class="number" data-v-5349f0a1>55</div><div class="min" data-v-5349f0a1>15\u5206\u9418</div></div><div class="time-row" data-v-5349f0a1><div class="icon-clock" data-v-5349f0a1></div><h4 data-v-5349f0a1>\u4E0B\u53486:03-\u4E0B\u53486:18</h4></div><div class="detaile" data-v-5349f0a1><div class="now-row row" data-v-5349f0a1><div class="icon-location2" data-v-5349f0a1></div><h4 class="now-title" data-v-5349f0a1>\u53F0\u4E2D\u706B\u8ECA\u7AD9</h4><h4 class="now-time" data-v-5349f0a1>\u4E0B\u53486:03</h4></div><h3 class="now-info" data-v-5349f0a1>\u6B65\u884C2\u5206\u9418</h3><div class="bus-row row" data-v-5349f0a1><div class="icon-location" data-v-5349f0a1></div><h4 class="bus-title" data-v-5349f0a1>\u53F0\u4E2D\u706B\u8ECA\u7AD9B\u6708\u53F0</h4><h4 class="bus-time" data-v-5349f0a1>\u4E0B\u53486:03</h4></div><div class="bus-info" data-v-5349f0a1><ul data-v-5349f0a1><li data-v-5349f0a1>\u5E72\u57CE\u7AD9</li><li data-v-5349f0a1>\u53F0\u4E2D\u516C\u5712</li><li data-v-5349f0a1>\u4E2D\u8208\u5802</li><li data-v-5349f0a1>\u570B\u7ACB\u81FA\u4E2D\u79D1\u6280\u5927\u5B78</li></ul></div><div class="destination-row row" data-v-5349f0a1><div class="icon-location2" data-v-5349f0a1></div><h4 class="destination-title" data-v-5349f0a1>\u4E2D\u53CB\u767E\u8CA8</h4><h4 class="destination-time" data-v-5349f0a1>\u4E0B\u53486:23</h4></div></div>',3),Lo={class:"mapWrap"};function bo(t,e,i,n,o,a){const r=p("RouteHeader"),d=p("Map");return c(),l("div",So,[_(r),$o,s("div",{class:S(["detaileWrap",{isOpen:o.isOpen}])},[s("div",go,[s("div",{class:"icon-back",onClick:e[0]||(e[0]=u=>o.isOpen=!o.isOpen)})]),yo],2),s("div",Lo,[_(d)])])}var wo=m(fo,[["render",bo],["__scopeId","data-v-5349f0a1"]]);const Bo={name:"route-plan-main",components:{Header:z,Footer:D,Map:M},data(){return{isHeaderShow:!0}},watch:{"$store.state.windowWidth":{handler:function(t,e){t<=769?this.isHeaderShow=!1:this.isHeaderShow=!0},immediate:!0}}},ko={class:"headerWrap"},No={class:"main"},Co={class:"sidebarWrap"},Oo={class:"map"};function Ro(t,e,i,n,o,a){const r=p("Header"),d=p("router-view"),u=p("Map"),h=p("Footer");return c(),l(f,null,[$(s("div",ko,[_(r)],512),[[y,o.isHeaderShow]]),s("div",No,[s("div",Co,[_(d)]),s("div",Oo,[_(u)])]),_(h)],64)}var xo=m(Bo,[["render",Ro],["__scopeId","data-v-740e2310"]]);const Io={name:"bus-time",components:{RouteHeader:H,SelectLocation:j},data(){return{busList:[],searchKeyWord:""}},methods:{getFavoriteList(){let t=localStorage.getItem("busTop_favorlist");return t!==null?JSON.parse(t):[]},saveFavoriteList(t){localStorage.setItem("busTop_favorlist",JSON.stringify(t))},likeHandler(t){let e=this.getFavoriteList(),i=this.busList[t].favorite;if(!i)e.push({location:this.$store.state.selectLocation,routeName:this.busList[t].title,OperatorName:this.busList[t].OperatorName,startStop:this.busList[t].startStop,endStop:this.busList[t].endStop}),this.saveFavoriteList(e),this.busList[t].favorite=!0;else if(i){let n=e.filter(o=>o.locationthis!==this.$store.state.selectLocation&&o.routeName!==this.busList[t].title);this.saveFavoriteList(n),this.busList[t].favorite=!1}},getKeywordBusList(t){t!==""&&R.get(`https://ptx.transportdata.tw/MOTC/v2/Bus/Route/City/${this.$store.state.selectLocation}/${t}?%24top=30&%24format=JSON`,{headers:T()}).then(e=>{this.busList=[],e.data.forEach(i=>{const n=i.RouteName.Zh_tw,o=i.Operators[0].OperatorName.Zh_tw;let a=i.DestinationStopNameZh,r=i.DepartureStopNameZh;a===void 0&&(a=""),r===void 0&&(r="");let d=this.getFavoriteList(),u=!1;d.forEach(h=>{h.location===this.$store.state.selectLocation&&h.routeName===n&&(u=!0)}),this.busList.push({icon:"icon-bus",title:n,location:`${a} - ${r}`,OperatorName:o,startStop:a,endStop:r,favorite:u})})}).catch(e=>{console.log(e)})},nextPage(t,e,i,n){this.$store.commit("setSearchBusRoute",{location:this.$store.state.selectLocation,routeName:t,OperatorName:e,startStop:i,endStop:n}),this.$router.push("/busResult")}},watch:{searchKeyWord:{handler(t,e){t===""&&(this.busList=[])}}},mounted(){this.$refs.myinput.focus()}},Mo={class:"m-header"},To={class:"searchWrap"},Ho={action:"javascript:void 0"},Po={class:"busList"},Ao=["onClick"],Wo={class:"info"},Eo={class:"title"},Fo={class:"location"},zo=["onClick"];function Do(t,e,i,n,o,a){const r=p("RouteHeader"),d=p("SelectLocation");return c(),l(f,null,[s("div",Mo,[_(r)]),_(d),s("div",To,[s("form",Ho,[$(s("input",{type:"search",placeholder:"\u641C\u5C0B\u516C\u8ECA\u8DEF\u7DDA/\u7AD9\u724C",ref:"myinput","onUpdate:modelValue":e[0]||(e[0]=u=>o.searchKeyWord=u),onKeydown:e[1]||(e[1]=mt(u=>a.getKeywordBusList(o.searchKeyWord),["enter"])),onInput:e[2]||(e[2]=u=>a.getKeywordBusList(o.searchKeyWord))},null,544),[[ft,o.searchKeyWord]])])]),s("div",Po,[s("ul",null,[(c(!0),l(f,null,g(o.busList,(u,h)=>(c(),l("li",{key:h,onClick:b=>a.nextPage(u.title,u.OperatorName,u.startStop,u.endStop)},[s("div",{class:S(u.icon)},null,2),s("div",Wo,[s("div",Eo,v(u.title),1),s("div",Fo,v(u.location),1)]),s("div",{onClick:A(b=>a.likeHandler(h),["stop"]),class:S({"icon-heart1":u.favorite,"icon-heart2":!u.favorite})},null,10,zo)],8,Ao))),128))])])],64)}var jo=m(Io,[["render",Do],["__scopeId","data-v-b20f28be"]]);const Zo={name:"bus_result",components:{RouteHeader:H,SelectLocation:j,Map:M},data(){return{isMobileShow:!1,activeIndex:this.$store.state.busPageActiveIndex,location:"",searchBusRoute:"",OperatorName:"",startStopName:"",endStopName:"",startStopOfRoute:[],endStopOfRoute:[],startLine:null,endLine:null,timer:null}},methods:{activeIndexHandler(t){this.endStopName!==""&&(this.$store.commit("setBusPageActiveIndex",t),this.activeIndex=t)},mobileShowHandler(){this.$store.commit("setisMobileShow",!0),this.isMobileShow=!0},mobileHideHandler(){this.$store.commit("setisMobileShow",!1),this.isMobileShow=!1},initData(){this.searchBusRoute=this.$store.state.searchBusRoute.routeName,this.OperatorName=this.$store.state.searchBusRoute.OperatorName,this.startStopName=this.$store.state.searchBusRoute.startStop,this.endStopName=this.$store.state.searchBusRoute.endStop},getStopOfRouteApi(){return new Promise((t,e)=>{R.get(`https://ptx.transportdata.tw/MOTC/v2/Bus/StopOfRoute/City/${this.$store.state.searchBusRoute.location}/${this.searchBusRoute}?%24top=500&%24format=JSON`,{headers:T()}).then(i=>{const n=this.searchBusRoute,o=i.data.filter(a=>a.RouteName.Zh_tw==n);o[0]&&(this.startStopOfRoute=o[0].Stops),o[1]&&(this.endStopOfRoute=o[1].Stops),t()}).catch(i=>{console.log(i)})})},getEstimatedTimeOfArrivalApi(){return new Promise((t,e)=>{R.get(`https://ptx.transportdata.tw/MOTC/v2/Bus/EstimatedTimeOfArrival/City/${this.$store.state.searchBusRoute.location}/${this.searchBusRoute}?%24top=500&%24format=JSON`,{headers:T()}).then(i=>{i.data.forEach(n=>{let o;if(n.NextBusTime===void 0?o="\u672A\u767C\u8ECA":o=n.NextBusTime.slice(11,16),n.Direction===0){for(let a=0;a<this.startStopOfRoute.length;a++)if(this.startStopOfRoute[a].StopName.Zh_tw==n.StopName.Zh_tw){n.EstimateTime!=null?n.EstimateTime/60==0?(this.startStopOfRoute[a].nextBusTime="\u9032\u7AD9\u4E2D",this.startStopOfRoute[a].state="pitStop"):n.EstimateTime/60<=3?(this.startStopOfRoute[a].nextBusTime=`${Math.trunc(n.EstimateTime/60)}\u5206\u9418`,this.startStopOfRoute[a].state="comming"):(this.startStopOfRoute[a].nextBusTime=`${Math.trunc(n.EstimateTime/60)}\u5206\u9418`,this.startStopOfRoute[a].state="none"):(this.startStopOfRoute[a].nextBusTime=o,this.startStopOfRoute[a].state="none");break}}else if(n.Direction===1){for(let a=0;a<this.endStopOfRoute.length;a++)if(this.endStopOfRoute[a].StopName.Zh_tw==n.StopName.Zh_tw){n.EstimateTime!=null?n.EstimateTime/60==0?(this.endStopOfRoute[a].nextBusTime="\u9032\u7AD9\u4E2D",this.endStopOfRoute[a].state="pitStop"):n.EstimateTime/60<=3?(this.endStopOfRoute[a].nextBusTime=`${Math.trunc(n.EstimateTime/60)}\u5206\u9418`,this.endStopOfRoute[a].state="comming"):(this.endStopOfRoute[a].nextBusTime=`${Math.trunc(n.EstimateTime/60)}\u5206\u9418`,this.endStopOfRoute[a].state="none"):(this.endStopOfRoute[a].nextBusTime=o,this.endStopOfRoute[a].state="none");break}}});for(let n=1;n<this.startStopOfRoute.length;n++)this.startStopOfRoute[n].state==="comming"&&this.startStopOfRoute[n-1].state==="none"&&(this.startStopOfRoute[n].nextBusTime="\u9032\u7AD9\u4E2D",this.startStopOfRoute[n].state="pitStop");for(let n=1;n<this.endStopOfRoute.length;n++)this.endStopOfRoute[n].state==="comming"&&this.endStopOfRoute[n-1].state==="none"&&(this.endStopOfRoute[n].nextBusTime="\u9032\u7AD9\u4E2D",this.endStopOfRoute[n].state="pitStop");t()}).catch(i=>{console.log(i)})})},getBusLineApi(){return new Promise((t,e)=>{R.get(`https://ptx.transportdata.tw/MOTC/v2/Bus/Shape/City/${this.$store.state.searchBusRoute.location}/${this.searchBusRoute}?%24top=24&%24format=JSON`,{headers:T()}).then(i=>{i.data.forEach(n=>{n.Direction===0&&this.searchBusRoute===n.RouteName.Zh_tw?this.$store.commit("setStartLine",n.Geometry):n.Direction===1&&this.searchBusRoute===n.RouteName.Zh_tw&&this.$store.commit("setEndLine",n.Geometry)}),this.$store.state.startLine===null&&i.data.forEach(n=>{this.searchBusRoute===n.RouteName.Zh_tw&&this.$store.state.startLine===null?this.$store.commit("setStartLine",n.Geometry):this.searchBusRoute===n.RouteName.Zh_tw&&this.$store.state.startLine!==null&&this.$store.commit("setEndLine",n.Geometry)}),this.$store.state.endLine===null&&this.$store.commit("setEndLine",this.$store.state.startLine),t()}).catch(i=>{console.log(i)})})},renderStopOfRoute(){const t=async()=>{this.$store.commit("setLoading",!0),await this.getStopOfRouteApi(),await this.getEstimatedTimeOfArrivalApi(),(()=>{this.$store.commit("setStartStopOfRoute",this.startStopOfRoute),this.$store.commit("setEndStopOfRoute",this.endStopOfRoute)})(),await this.getBusLineApi(),this.$store.commit("setLoading",!1)};t(),this.timer=setInterval(()=>{t()},3e4)}},watch:{"$store.state.windowWidth":function(t,e){t>769&&(this.isMobileShow=!1)},endStopName:{handler:function(t,e){t==""&&(this.$store.commit("setBusPageActiveIndex",0),this.activeIndex=0)},immediate:!0}},mounted(){this.initData(),this.renderStopOfRoute()},unmounted(){this.$store.commit("setStartStopOfRoute",[]),this.$store.commit("setEndStopOfRoute",[]),this.$store.commit("setStartLine",null),this.$store.commit("setEndLine",null),this.timer&&clearInterval(this.timer)}},Z=t=>(w("data-v-3d8e591f"),t=t(),B(),t),Ko={class:"m-header"},Uo={class:"container"},Jo={class:"title"},Go={class:"subTitle"},Vo={class:"tabWrap"},Xo={key:0,class:"dynamicBusData"},qo={class:"time"},Yo={class:"routeName"},Qo=Z(()=>s("div",{class:"icon"},[s("span",{class:"circle"})],-1)),ti={key:1,class:"dynamicBusData"},ei={class:"time"},si={class:"routeName"},oi=Z(()=>s("div",{class:"icon"},[s("span",{class:"circle"})],-1)),ii={class:"m-mapContainer"},ai={class:"mapBackHeader"},ni=Z(()=>s("div",{class:"title"},"\u8DEF\u7DDA\u5716",-1)),ri={class:"mapWrap"};function ci(t,e,i,n,o,a){const r=p("RouteHeader"),d=p("SelectLocation"),u=p("Map");return c(),l(f,null,[s("div",Ko,[_(r),s("div",{class:"icon-route",onClick:e[0]||(e[0]=(...h)=>a.mobileShowHandler&&a.mobileShowHandler(...h))})]),_(d),s("div",Uo,[s("h3",Jo,v(this.searchBusRoute),1),s("div",Go,v(this.OperatorName)+"/\u4E00\u6BB5\u7968",1),s("div",Vo,[s("h4",{class:S(["tab",{active:o.activeIndex===0}]),onClick:e[1]||(e[1]=h=>a.activeIndexHandler(0))}," \u5F80"+v(o.startStopName),3),s("h4",{class:S(["tab",{active:o.activeIndex===1}]),onClick:e[2]||(e[2]=h=>a.activeIndexHandler(1))}," \u5F80"+v(o.endStopName),3)]),o.activeIndex===0?(c(),l("ul",Xo,[(c(!0),l(f,null,g(o.startStopOfRoute,(h,b)=>(c(),l("li",{key:b,class:S({pitStop:h.state==="pitStop",comming:h.state==="comming"})},[s("div",qo,v(h.nextBusTime),1),s("h3",Yo,v(h.StopName.Zh_tw),1),Qo],2))),128))])):o.activeIndex===1?(c(),l("ul",ti,[(c(!0),l(f,null,g(o.endStopOfRoute,(h,b)=>(c(),l("li",{key:b,class:S({pitStop:h.state==="pitStop",comming:h.state==="comming"})},[s("div",ei,v(h.nextBusTime),1),s("h3",si,v(h.StopName.Zh_tw),1),oi],2))),128))])):x("",!0)]),$(s("div",ii,[s("div",ai,[s("div",{class:"icon-back",onClick:e[3]||(e[3]=(...h)=>a.mobileHideHandler&&a.mobileHideHandler(...h))}),ni]),s("div",ri,[_(u)])],512),[[y,o.isMobileShow]])],64)}var li=m(Zo,[["render",ci],["__scopeId","data-v-3d8e591f"]]);const di=[{path:"/",component:qt,children:[{path:"/searchPlan",component:Se},{path:"/searchBus",component:Bs}]},{component:Is,children:[{path:"/routePlan",component:oo},{path:"/busStation",component:vo},{path:"/routeResult",component:wo}]},{component:xo,children:[{path:"/busTime",component:jo},{path:"/busResult",component:li,beforeEnter:(t,e,i)=>{V.state.searchBusRoute.location===""?i({path:"/busTime"}):i()}}]}],ui=St({history:$t(),routes:di}),K=gt(kt);K.use(ui);K.use(V);K.mount("#app");
